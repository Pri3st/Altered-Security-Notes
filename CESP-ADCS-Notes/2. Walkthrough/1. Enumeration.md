## `certbulk.cb.corp` ##
- We will begin by enumerating `certbulk.cb.corp`, the domain we are currently in.
- We will use **PowerView** and **BloodHound**.

- Find Domain Information.
```powershell
PS C:\ADCS\Auditor> Get-Domain


Forest                  : cb.corp
DomainControllers       : {cb-dc.certbulk.cb.corp}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  : cb.corp
PdcRoleOwner            : cb-dc.certbulk.cb.corp
RidRoleOwner            : cb-dc.certbulk.cb.corp
InfrastructureRoleOwner : cb-dc.certbulk.cb.corp
Name                    : certbulk.cb.corp
```

- Find Domain Trusts.
```powershell
PS C:\ADCS\Auditor> Get-DomainTrust


SourceName      : certbulk.cb.corp
TargetName      : cb.corp
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST
TrustDirection  : Bidirectional
WhenCreated     : 4/18/2023 1:09:01 PM
WhenChanged     : 9/15/2023 4:00:45 AM
```

-> We have a bidirectional trust with the parent domain, `cb.corp`.
-> We should enumerate the parent domain as well.

- Find Domain Users.
```powershell
PS C:\ADCS\Auditor> Get-DomainUser | Select-Object samaccountname,description | Where-Object -Property samaccountname -notlike "student*"

samaccountname description
-------------- -----------
Administrator  Built-in account for administering the computer/domain
Guest          Built-in account for guest access to the computer/domain
krbtgt         Key Distribution Center Service Account
signadmin
vault
```

-> Interesting domain users:
	- `certbulk\signadmin`
	- `certbulk\vault`

- Find Domain Computers.
```powershell
PS C:\ADCS\Auditor> Get-DomainComputer | Select-Object -Property distinguishedname,samaccountname,operatingsystem,serviceprincipalname,cn,dnshostname | Where-Object -Property samaccountname -notlike "cb-ws*"


distinguishedname    : CN=CB-DC,OU=Domain Controllers,DC=certbulk,DC=cb,DC=corp
samaccountname       : CB-DC$
operatingsystem      : Windows Server 2022 Standard
serviceprincipalname : {ldap/cb-dc.certbulk.cb.corp/DomainDnsZones.certbulk.cb.corp,
                       ldap/cb-dc.certbulk.cb.corp/ForestDnsZones.cb.corp,
                       Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/cb-dc.certbulk.cb.corp, TERMSRV/CB-DC...}
cn                   : CB-DC
dnshostname          : cb-dc.certbulk.cb.corp

distinguishedname    : CN=CB-WEBAPP1,CN=Computers,DC=certbulk,DC=cb,DC=corp
samaccountname       : CB-WEBAPP1$
operatingsystem      : Windows Server 2022 Datacenter
serviceprincipalname : {TERMSRV/CB-WEBAPP1, TERMSRV/cb-webapp1.certbulk.cb.corp, RestrictedKrbHost/CB-WEBAPP1,
                       HOST/CB-WEBAPP1...}
cn                   : CB-WEBAPP1
dnshostname          : cb-webapp1.certbulk.cb.corp

distinguishedname    : CN=CB-STORE,CN=Computers,DC=certbulk,DC=cb,DC=corp
samaccountname       : CB-STORE$
operatingsystem      : Windows Server 2022 Datacenter
serviceprincipalname : {TERMSRV/CB-STORE, TERMSRV/cb-store.certbulk.cb.corp, RestrictedKrbHost/CB-STORE,
                       HOST/CB-STORE...}
cn                   : CB-STORE
dnshostname          : cb-store.certbulk.cb.corp

distinguishedname    : CN=CB-SIGNSRV,OU=WDAC Computers,DC=certbulk,DC=cb,DC=corp
samaccountname       : CB-SIGNSRV$
operatingsystem      : Windows Server 2022 Datacenter
serviceprincipalname : {WSMAN/cb-signsrv, WSMAN/cb-signsrv.certbulk.cb.corp, TERMSRV/CB-SIGNSRV,
                       TERMSRV/cb-signsrv.certbulk.cb.corp...}
cn                   : CB-SIGNSRV
dnshostname          : cb-signsrv.certbulk.cb.corp

distinguishedname    : CN=CB-VAULT,CN=Computers,DC=certbulk,DC=cb,DC=corp
samaccountname       : CB-VAULT$
operatingsystem      : pc-linux-gnu
serviceprincipalname : {RestrictedKrbHost/cb-vault.certbulk.cb.corp, RestrictedKrbHost/CB-VAULT,
                       host/cb-vault.certbulk.cb.corp, host/CB-VAULT}
cn                   : CB-VAULT
dnshostname          : cb-vault.certbulk.cb.corp
```

- Find Domain Controllers.
```powershell
PS C:\ADCS\Auditor> Get-DomainController


Forest                     : cb.corp
CurrentTime                : 9/15/2023 7:45:30 AM
HighestCommittedUsn        : 81428
OSVersion                  : Windows Server 2022 Standard
Roles                      : {PdcRole, RidRole, InfrastructureRole}
Domain                     : certbulk.cb.corp
IPAddress                  : 172.16.67.1
SiteName                   : Default-First-Site-Name
SyncFromAllServersCallback :
InboundConnections         : {edd5283b-f938-4096-9304-088b0044c7fc}
OutboundConnections        : {bb102b3d-5db9-4861-b00c-7e3a85c76430}
Name                       : cb-dc.certbulk.cb.corp
Partitions                 : {CN=Configuration,DC=cb,DC=corp, CN=Schema,CN=Configuration,DC=cb,DC=corp,
                             DC=ForestDnsZones,DC=cb,DC=corp, DC=certbulk,DC=cb,DC=corp...}
```

- Find Domain Groups.
```powershell
PS C:\ADCS\Auditor> Get-DomainGroup | Select-Object -Property cn,description

cn                                      description
--                                      -----------
Administrators                          Administrators have complete and unrestricted access to the computer/domain
Users                                   Users are prevented from making accidental or intentional system-wide changes and...
Guests                                  Guests have the same access as members of the Users group by default, except for ...
Print Operators                         Members can administer printers installed on domain controllers
Backup Operators                        Backup Operators can override security restrictions for the sole purpose of backi...
Replicator                              Supports file replication in a domain
Remote Desktop Users                    Members in this group are granted the right to logon remotely
Network Configuration Operators         Members in this group can have some administrative privileges to manage configura...
Performance Monitor Users               Members of this group can access performance counter data locally and remotely
Performance Log Users                   Members of this group may schedule logging of performance counters, enable trace ...
Distributed COM Users                   Members are allowed to launch, activate and use Distributed COM objects on this m...
IIS_IUSRS                               Built-in group used by Internet Information Services.
Cryptographic Operators                 Members are authorized to perform cryptographic operations.
Event Log Readers                       Members of this group can read event logs from local machine
Certificate Service DCOM Access         Members of this group are allowed to connect to Certification Authorities in the ...
RDS Remote Access Servers               Servers in this group enable users of RemoteApp programs and personal virtual des...
RDS Endpoint Servers                    Servers in this group run virtual machines and host sessions where users RemoteAp...
RDS Management Servers                  Servers in this group can perform routine administrative actions on servers runni...
Hyper-V Administrators                  Members of this group have complete and unrestricted access to all features of Hy...
Access Control Assistance Operators     Members of this group can remotely query authorization attributes and permissions...
Remote Management Users                 Members of this group can access WMI resources over management protocols (such as...
Storage Replica Administrators          Members of this group have complete and unrestricted access to all features of St...
Domain Computers                        All workstations and servers joined to the domain
Domain Controllers                      All domain controllers in the domain
Cert Publishers                         Members of this group are permitted to publish certificates to the directory
Domain Admins                           Designated administrators of the domain
Domain Users                            All domain users
Domain Guests                           All domain guests
Group Policy Creator Owners             Members in this group can modify group policy for the domain
RAS and IAS Servers                     Servers in this group can access remote access properties of users
Server Operators                        Members can administer domain servers
Account Operators                       Members can administer domain user and group accounts
Pre-Windows 2000 Compatible Access      A backward compatibility group which allows read access on all users and groups i...
Windows Authorization Access Group      Members of this group have access to the computed tokenGroupsGlobalAndUniversal a...
Terminal Server License Servers         Members of this group can update user accounts in Active Directory with informati...
Allowed RODC Password Replication Group Members in this group can have their passwords replicated to all read-only domain...
Denied RODC Password Replication Group  Members in this group cannot have their passwords replicated to any read-only dom...
Read-only Domain Controllers            Members of this group are Read-Only Domain Controllers in the domain
Cloneable Domain Controllers            Members of this group that are domain controllers may be cloned.
Protected Users                         Members of this group are afforded additional protections against authentication ...
Key Admins                              Members of this group can perform administrative actions on key objects within th...
DnsAdmins                               DNS Administrators Group
DnsUpdateProxy                          DNS clients who are permitted to perform dynamic updates on behalf of some other ...
sudoers
VaultUsers
VaultAdmins
```

-> Interesting domain groups:
	- **sudoers**
	- **VaultUsers**
	- **VaultAdmins**

- Find Domain OUs.
```powershell
PS C:\ADCS\Auditor> Get-DomainOU | Select-Object -Property name,gplink

name               gplink
----               ------
Domain Controllers [LDAP://CN={6AC1786C-016F-11D2-945F-00C04fB984F9},CN=Policies,CN=System,DC=certbulk,DC=cb,DC=corp;0]
WDAC Computers     [LDAP://cn={A124A54E-7EE8-4D22-A117-8A180832FD97},cn=policies,cn=system,DC=certbulk,DC=cb,DC=corp;0]
VaultGroups
```

- Find Computers in the respective OUs.
```powershell
PS C:\ADCS\Auditor> (Get-DomainOU -Identity VaultGroups).distinguishedname | %{Get-DomainComputer -SearchBase $_} | select name
PS C:\ADCS\Auditor> (Get-DomainOU -Identity 'WDAC Computers').distinguishedname | %{Get-DomainComputer -SearchBase $_} | select name

name
----
CB-SIGNSRV
```

- Find accounts (computers) with KUD permissions set.
```powershell
PS C:\ADCS\Auditor> Get-DomainComputer -Unconstrained | Select-Object samaccountname

samaccountname
--------------
CB-DC$
```

## `cb.corp` ##

- Find Domain Info.
```powershell
PS C:\ADCS\Auditor> Get-Domain -Domain cb.corp

Forest                  : cb.corp
DomainControllers       : {cb-ca.cb.corp}
Children                : {certbulk.cb.corp}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  :
PdcRoleOwner            : cb-ca.cb.corp
RidRoleOwner            : cb-ca.cb.corp
InfrastructureRoleOwner : cb-ca.cb.corp
Name                    : cb.corp
```

- Find Domain Users.
```powershell
PS C:\ADCS\Auditor> Get-DomainUser -Domain cb.corp | Select-Object samaccountname,description

samaccountname description
-------------- -----------
Administrator  Built-in account for administering the computer/domain
Guest          Built-in account for guest access to the computer/domain
krbtgt         Key Distribution Center Service Account
certstore
mgmtadmin
cloudadmin     Azure AD admin - cloudadmin@certbulk.onmicrosoft.com
```

-> Interesting domain users:
	- `cb\certstore`
	- `cb\mgmtadmin`
	- `cb\cloudadmin`

- Find Domain Computers.
```powershell
PS C:\ADCS\Auditor> Get-DomainComputer -Domain cb.corp | Select-Object samaccountname

samaccountname
--------------
CB-CA$
```

- SharpHound for data visualisation.
- We will need to transport the data in our own machine with BloodHound installed to view the data.
- SharpHound is too noisy and not OPSEC-wise.
```powershell
PS C:\ADCS\Auditor> Invoke-BloodHound -CollectionMethods All -OutputPrefix certbulk.cb.corp -OutputDirectory C:\ADCS\Auditor\
2023-09-15T01:02:21.3847512-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound
2023-09-15T01:02:21.6191760-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2023-09-15T01:02:21.6503333-07:00|INFORMATION|Initializing SharpHound at 1:02 AM on 9/15/2023
2023-09-15T01:02:21.9472107-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller for certbulk.cb.corp : cb-dc.certbulk.cb.corp
2023-09-15T01:02:22.1972441-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2023-09-15T01:02:26.8947525-07:00|INFORMATION|Beginning LDAP search for certbulk.cb.corp

<snip>

PS C:\ADCS\Auditor> Invoke-BloodHound -Domain cb.corp -CollectionMethods All -OutputPrefix cb.corp -OutputDirectory C:\ADCS\Auditor\
2023-09-15T01:03:55.1973984-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound
2023-09-15T01:03:55.2130506-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2023-09-15T01:03:55.2130506-07:00|INFORMATION|Initializing SharpHound at 1:03 AM on 9/15/2023
2023-09-15T01:03:55.3067056-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller for cb.corp : cb-ca.cb.corp
2023-09-15T01:03:55.7910591-07:00|INFORMATION|Loaded cache with stats: 103 ID to type mappings.
 102 name to SID mappings.
 0 machine sid mappings.
 5 sid to domain mappings.
 0 global catalog mappings.
2023-09-15T01:03:55.7910591-07:00|WARNING|Common Library is already initialized
2023-09-15T01:03:55.7910591-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2023-09-15T01:03:55.8535612-07:00|INFORMATION|Beginning LDAP search for cb.corp

<snip>
```

- Interesting BloodHound Findings
	- New domain trust
![[internalcb_trust.png]]

- Search for the CA.
```powershell
PS C:\ADCS\Auditor> .\Certify.exe cas

   _____          _   _  __
  / ____|        | | (_)/ _|
 | |     ___ _ __| |_ _| |_ _   _
 | |    / _ \ '__| __| |  _| | | |
 | |___|  __/ |  | |_| | | | |_| |
  \_____\___|_|   \__|_|_|  \__, |
                             __/ |
                            |___./
  v1.1.0

[*] Action: Find certificate authorities
[*] Using the search base 'CN=Configuration,DC=cb,DC=corp'


[*] Root CAs

    Cert SubjectName              : CN=CB-CA, DC=cb, DC=corp
    Cert Thumbprint               : 75E734EE4BB472BD99FF2E308DE9B95EEAF80C3F
    Cert Serial                   : 51F5AA83C01B57B34635410A3738E79D
    Cert Start Date               : 1/11/2023 4:46:01 AM
    Cert End Date                 : 1/11/2028 4:56:01 AM
    Cert Chain                    : CN=CB-CA,DC=cb,DC=corp


[*] NTAuthCertificates - Certificates that enable authentication:

    Cert SubjectName              : CN=CB-CA, DC=cb, DC=corp
    Cert Thumbprint               : 75E734EE4BB472BD99FF2E308DE9B95EEAF80C3F
    Cert Serial                   : 51F5AA83C01B57B34635410A3738E79D
    Cert Start Date               : 1/11/2023 4:46:01 AM
    Cert End Date                 : 1/11/2028 4:56:01 AM
    Cert Chain                    : CN=CB-CA,DC=cb,DC=corp


[*] Enterprise/Enrollment CAs:

    Enterprise CA Name            : CB-CA
    DNS Hostname                  : cb-ca.cb.corp
    FullName                      : cb-ca.cb.corp\CB-CA
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=CB-CA, DC=cb, DC=corp
    Cert Thumbprint               : 75E734EE4BB472BD99FF2E308DE9B95EEAF80C3F
    Cert Serial                   : 51F5AA83C01B57B34635410A3738E79D
    Cert Start Date               : 1/11/2023 4:46:01 AM
    Cert End Date                 : 1/11/2028 4:56:01 AM
    Cert Chain                    : CN=CB-CA,DC=cb,DC=corp
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates, Enroll       INTERNALCB\internaluser       S-1-5-21-2177854049-4204292666-1463338204-1104
      Allow  ManageCA, ManageCertificates               CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
      Allow  ManageCA, ManageCertificates               CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
    Enrollment Agent Restrictions : None

    Enabled Certificate Templates:
        SecureSigner
        StoreDataRecovery-Agent
        StoreDataRecovery
        SecureUpdate
        DirectoryEmailReplication
        DomainControllerAuthentication
        KerberosAuthentication
        EFSRecovery
        EFS
        DomainController
        WebServer
        Machine
        User
        SubCA
        Administrator





Certify completed in 00:00:05.0108826
```

- Search for certificate templates.
```powershell
PS C:\ADCS\Auditor> .\Certify.exe find

   _____          _   _  __
  / ____|        | | (_)/ _|
 | |     ___ _ __| |_ _| |_ _   _
 | |    / _ \ '__| __| |  _| | | |
 | |___|  __/ |  | |_| | | | |_| |
  \_____\___|_|   \__|_|_|  \__, |
                             __/ |
                            |___./
  v1.1.0

[*] Action: Find certificate templates
[*] Using the search base 'CN=Configuration,DC=cb,DC=corp'

[*] Listing info about the Enterprise CA 'CB-CA'

    Enterprise CA Name            : CB-CA
    DNS Hostname                  : cb-ca.cb.corp
    FullName                      : cb-ca.cb.corp\CB-CA
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=CB-CA, DC=cb, DC=corp
    Cert Thumbprint               : 75E734EE4BB472BD99FF2E308DE9B95EEAF80C3F
    Cert Serial                   : 51F5AA83C01B57B34635410A3738E79D
    Cert Start Date               : 1/11/2023 4:46:01 AM
    Cert End Date                 : 1/11/2028 4:56:01 AM
    Cert Chain                    : CN=CB-CA,DC=cb,DC=corp
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates, Enroll       INTERNALCB\internaluser       S-1-5-21-2177854049-4204292666-1463338204-1104
      Allow  ManageCA, ManageCertificates               CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
      Allow  ManageCA, ManageCertificates               CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
    Enrollment Agent Restrictions : None

[*] Available Certificates Templates :

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : User
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Secure Email
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Users               S-1-5-21-2928296033-1822922359-262865665-513
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CERTBULK\Domain Users         S-1-5-21-3604858216-2548435023-1717832235-513
                                      INTERNALCB\Domain Users       S-1-5-21-2177854049-4204292666-1463338204-513
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : EFS
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Encrypting File System
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Users               S-1-5-21-2928296033-1822922359-262865665-513
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : Administrator
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Microsoft Trust List Signing, Secure Email
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CERTBULK\Domain Admins        S-1-5-21-3604858216-2548435023-1717832235-512
                                      INTERNALCB\Domain Admins      S-1-5-21-2177854049-4204292666-1463338204-512
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : EFSRecovery
    Schema Version                        : 1
    Validity Period                       : 5 years
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : File Recovery
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : Machine
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DNS, SUBJECT_REQUIRE_DNS_AS_CN
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Server Authentication
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Computers           S-1-5-21-2928296033-1822922359-262865665-515
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CERTBULK\Domain Computers     S-1-5-21-3604858216-2548435023-1717832235-515
                                      INTERNALCB\Domain Computers   S-1-5-21-2177854049-4204292666-1463338204-515
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : DomainController
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DIRECTORY_GUID, SUBJECT_ALT_REQUIRE_DNS, SUBJECT_REQUIRE_DNS_AS_CN
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Server Authentication
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Controllers         S-1-5-21-2928296033-1822922359-262865665-516
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CB\Enterprise Read-only Domain ControllersS-1-5-21-2928296033-1822922359-262865665-498
                                      CERTBULK\Domain Controllers   S-1-5-21-3604858216-2548435023-1717832235-516
                                      INTERNALCB\Domain Controllers S-1-5-21-2177854049-4204292666-1463338204-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : WebServer
    Schema Version                        : 1
    Validity Period                       : 2 years
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : NONE
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Server Authentication
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : SubCA
    Schema Version                        : 1
    Validity Period                       : 5 years
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : NONE
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : <null>
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      INTERNALCB\Domain Admins      S-1-5-21-2177854049-4204292666-1463338204-512
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : DomainControllerAuthentication
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DNS
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Server Authentication, Smart Card Logon
    mspki-certificate-application-policy  : Client Authentication, Server Authentication, Smart Card Logon
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Controllers         S-1-5-21-2928296033-1822922359-262865665-516
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CB\Enterprise Read-only Domain ControllersS-1-5-21-2928296033-1822922359-262865665-498
                                      CERTBULK\Domain Controllers   S-1-5-21-3604858216-2548435023-1717832235-516
                                      INTERNALCB\Domain Controllers S-1-5-21-2177854049-4204292666-1463338204-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : DirectoryEmailReplication
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DIRECTORY_GUID, SUBJECT_ALT_REQUIRE_DNS
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Directory Service Email Replication
    mspki-certificate-application-policy  : Directory Service Email Replication
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Controllers         S-1-5-21-2928296033-1822922359-262865665-516
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CB\Enterprise Read-only Domain ControllersS-1-5-21-2928296033-1822922359-262865665-498
                                      CERTBULK\Domain Controllers   S-1-5-21-3604858216-2548435023-1717832235-516
                                      INTERNALCB\Domain Controllers S-1-5-21-2177854049-4204292666-1463338204-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : KerberosAuthentication
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DOMAIN_DNS, SUBJECT_ALT_REQUIRE_DNS
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, KDC Authentication, Server Authentication, Smart Card Logon
    mspki-certificate-application-policy  : Client Authentication, KDC Authentication, Server Authentication, Smart Card Logon
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Domain Controllers         S-1-5-21-2928296033-1822922359-262865665-516
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CB\Enterprise Read-only Domain ControllersS-1-5-21-2928296033-1822922359-262865665-498
                                      CERTBULK\Domain Controllers   S-1-5-21-3604858216-2548435023-1717832235-516
                                      INTERNALCB\Domain Controllers S-1-5-21-2177854049-4204292666-1463338204-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteOwner Principals       : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : SecureUpdate
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Windows Update
    mspki-certificate-application-policy  : Client Authentication, Windows Update
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
      Object Control Permissions
        Owner                       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
        WriteOwner Principals       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\certstore                  S-1-5-21-2928296033-1822922359-262865665-1105
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\certstore                  S-1-5-21-2928296033-1822922359-262865665-1105
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\certstore                  S-1-5-21-2928296033-1822922359-262865665-1105
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : StoreDataRecovery-Agent
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Certificate Request Agent
    mspki-certificate-application-policy  : Certificate Request Agent
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\certstore                  S-1-5-21-2928296033-1822922359-262865665-1105
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
      Object Control Permissions
        Owner                       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
        WriteOwner Principals       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : StoreDataRecovery
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 1
    Application Policies                  : Certificate Request Agent
    pkiextendedkeyusage                   : Client Authentication, File Recovery
    mspki-certificate-application-policy  : Client Authentication, File Recovery
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\certstore                  S-1-5-21-2928296033-1822922359-262865665-1105
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
      Object Control Permissions
        Owner                       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
        WriteOwner Principals       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

    CA Name                               : cb-ca.cb.corp\CB-CA
    Template Name                         : SecureSigner
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Code Signing
    mspki-certificate-application-policy  : Code Signing
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
                                      CERTBULK\signadmin            S-1-5-21-3604858216-2548435023-1717832235-1110
      Object Control Permissions
        Owner                       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
        WriteOwner Principals       : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteDacl Principals        : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519
        WriteProperty Principals    : CB\Administrator              S-1-5-21-2928296033-1822922359-262865665-500
                                      CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
                                      CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519



Certify completed in 00:00:06.6378379
```

## `protectedcb.corp` ##
- Find Domain Information.
```powershell
PS C:\ADCS\Auditor> Get-Domain -Domain protectedcb.corp


Forest                  : protectedcb.corp
DomainControllers       : {cbp-dc.protectedcb.corp}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  :
PdcRoleOwner            : cbp-dc.protectedcb.corp
RidRoleOwner            : cbp-dc.protectedcb.corp
InfrastructureRoleOwner : cbp-dc.protectedcb.corp
Name                    : protectedcb.corp
```

- Find Domain Users.
```powershell
PS C:\ADCS\Auditor> Get-DomainUser -Domain protectedcb.corp | Select-Object samaccountname,description

samaccountname description
-------------- -----------
Administrator  Built-in account for administering the computer/domain
Guest          Built-in account for guest access to the computer/domain
krbtgt         Key Distribution Center Service Account
protecteduser
```

- Find Domain Computers.
```powershell
PS C:\ADCS\Auditor> Get-DomainComputer -Domain protectedcb.corp | Select-Object samaccountname

samaccountname
--------------
CBP-DC$
CBP-WS17$
```

- No other interesting information comes up when we search for Trusts, Groups, OUs and GPOs.
- BloodHound
```powershell
PS C:\ADCS\Auditor> ipmo .\SharpHound.ps1
PS C:\ADCS\Auditor> Invoke-BloodHound -CollectionMethods All -Domain protectedcb.corp -OutputPrefix protectedcb.corp -OutputDirectory C:\ADCS\Auditor\
2023-09-18T08:42:32.5715637-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound
2023-09-18T08:42:32.7589855-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2023-09-18T08:42:32.7746774-07:00|INFORMATION|Initializing SharpHound at 8:42 AM on 9/18/2023
2023-09-18T08:42:33.1968517-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller for protectedcb.corp : cbp-dc.protectedcb.corp
2023-09-18T08:42:33.6652344-07:00|INFORMATION|Loaded cache with stats: 153 ID to type mappings.
 154 name to SID mappings.
 0 machine sid mappings.
 5 sid to domain mappings.
 0 global catalog mappings.
2023-09-18T08:42:33.6678369-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2023-09-18T08:42:33.7747079-07:00|ERROR|[CommonLib ACLProc]BuildGUIDCache - Unable to resolve forest

<snip>

2023-09-18T08:42:36.4937522-07:00|INFORMATION|Beginning LDAP search for protectedcb.corp
2023-09-18T08:42:41.4152169-07:00|INFORMATION|Producer has finished, closing LDAP channel
2023-09-18T08:42:41.4308446-07:00|INFORMATION|LDAP channel closed, waiting for consumers

<snip>
```

- Find CAs for this domain.
```powershell
PS C:\ADCS\Auditor> .\CertifyKit.exe cas /domain:protectedcb.corp
CertifyKit (Hagrid29 version of Certify)
More info: https://github.com/Hagrid29/CertifyKit/

[*] Action: Find certificate authorities
[*] Using the search base 'CN=Configuration,DC=protectedcb,DC=corp'


[*] Root CAs

    Cert SubjectName              : CN=CBP-CA, DC=protectedcb, DC=corp
    Cert Thumbprint               : EDF39D1926DAEC39B15E10FD01217AC01EAD3C94
    Cert Serial                   : 16E3DBC9B04AC888478EBF5073E0A98A
    Cert Start Date               : 1/13/2023 3:14:52 AM
    Cert End Date                 : 1/13/2028 3:24:52 AM
    Cert Chain                    : CN=CBP-CA,DC=protectedcb,DC=corp



[*] NTAuthCertificates - Certificates that enable authentication:

    Cert SubjectName              : CN=CBP-CA, DC=protectedcb, DC=corp
    Cert Thumbprint               : EDF39D1926DAEC39B15E10FD01217AC01EAD3C94
    Cert Serial                   : 16E3DBC9B04AC888478EBF5073E0A98A
    Cert Start Date               : 1/13/2023 3:14:52 AM
    Cert End Date                 : 1/13/2028 3:24:52 AM
    Cert Chain                    : CN=CBP-CA,DC=protectedcb,DC=corp


[*] Enterprise/Enrollment CAs:

    Enterprise CA Name            : CBP-CA
    DNS Hostname                  : cbp-dc.protectedcb.corp
    FullName                      : cbp-dc.protectedcb.corp\CBP-CA
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=CBP-CA, DC=protectedcb, DC=corp
    Cert Thumbprint               : EDF39D1926DAEC39B15E10FD01217AC01EAD3C94
    Cert Serial                   : 16E3DBC9B04AC888478EBF5073E0A98A
    Cert Start Date               : 1/13/2023 3:14:52 AM
    Cert End Date                 : 1/13/2028 3:24:52 AM
    Cert Chain                    : CN=CBP-CA,DC=protectedcb,DC=corp
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates               <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
      Allow  ManageCA, ManageCertificates               <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
    Enrollment Agent Restrictions : None

    Enabled Certificate Templates:
        Substitute-ProtectedUserAccess
        ProtectedUserAccess
        DirectoryEmailReplication
        DomainControllerAuthentication
        KerberosAuthentication
        EFSRecovery
        EFS
        DomainController
        WebServer
        Machine
        User
        SubCA
        Administrator





CertifyKit completed in 00:00:04.6496498
```

- Find certificate templates for this domain.
```powershell
PS C:\ADCS\Auditor> .\CertifyKit.exe find /domain:protectedcb.corp
CertifyKit (Hagrid29 version of Certify)
More info: https://github.com/Hagrid29/CertifyKit/

[*] Action: Find certificate templates
[*] Using the search base 'CN=Configuration,DC=protectedcb,DC=corp'

[*] Listing info about the Enterprise CA 'CBP-CA'

    Enterprise CA Name            : CBP-CA
    DNS Hostname                  : cbp-dc.protectedcb.corp
    FullName                      : cbp-dc.protectedcb.corp\CBP-CA
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=CBP-CA, DC=protectedcb, DC=corp
    Cert Thumbprint               : EDF39D1926DAEC39B15E10FD01217AC01EAD3C94
    Cert Serial                   : 16E3DBC9B04AC888478EBF5073E0A98A
    Cert Start Date               : 1/13/2023 3:14:52 AM
    Cert End Date                 : 1/13/2028 3:24:52 AM
    Cert Chain                    : CN=CBP-CA,DC=protectedcb,DC=corp
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates               <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
      Allow  ManageCA, ManageCertificates               <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
    Enrollment Agent Restrictions : None

[*] Available Certificates Templates :

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : User
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Secure Email
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-513
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : EFS
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Encrypting File System
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-513
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : Administrator
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Microsoft Trust List Signing, Secure Email
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : EFSRecovery
    Schema Version                        : 1
    Validity Period                       : 5 years
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : File Recovery
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : Machine
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DNS, SUBJECT_REQUIRE_DNS_AS_CN
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Server Authentication
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-515
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : DomainController
    Schema Version                        : 1
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DIRECTORY_GUID, SUBJECT_ALT_REQUIRE_DNS, SUBJECT_REQUIRE_DNS_AS_CN
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Server Authentication
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : WebServer
    Schema Version                        : 1
    Validity Period                       : 2 years
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : NONE
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Server Authentication
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : SubCA
    Schema Version                        : 1
    Validity Period                       : 5 years
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : NONE
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : <null>
    mspki-certificate-application-policy  : <null>
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : DomainControllerAuthentication
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DNS
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Server Authentication, Smart Card Logon
    mspki-certificate-application-policy  : Client Authentication, Server Authentication, Smart Card Logon
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
        AutoEnrollment Rights       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : DirectoryEmailReplication
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DIRECTORY_GUID, SUBJECT_ALT_REQUIRE_DNS
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Directory Service Email Replication
    mspki-certificate-application-policy  : Directory Service Email Replication
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
        AutoEnrollment Rights       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : KerberosAuthentication
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : SUBJECT_ALT_REQUIRE_DOMAIN_DNS, SUBJECT_ALT_REQUIRE_DNS
    mspki-enrollment-flag                 : AUTO_ENROLLMENT
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, KDC Authentication, Server Authentication, Smart Card Logon
    mspki-certificate-application-policy  : Client Authentication, KDC Authentication, Server Authentication, Smart Card Logon
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
        AutoEnrollment Rights       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-498
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-516
                                      NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERSS-1-5-9
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : ProtectedUserAccess
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication
    mspki-certificate-application-policy  : Client Authentication
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-1104
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519

    CA Name                               : cbp-dc.protectedcb.corp\CBP-CA
    Template Name                         : Substitute-ProtectedUserAccess
    Schema Version                        : 2
    Validity Period                       : 6 days
    Renewal Period                        : 10 hours
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Any Purpose
    mspki-certificate-application-policy  : Any Purpose
    Permissions
      Enrollment Permissions
        Enrollment Rights           : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-1104
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
      Object Control Permissions
        Owner                       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
        WriteOwner Principals       : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteDacl Principals        : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519
        WriteProperty Principals    : <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-500
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-512
                                      <UNKNOWN>                     S-1-5-21-1286082170-882298176-404569034-519



CertifyKit completed in 00:00:07.3712362
```

## `internalcb.corp` ##
- Find Domain Information.
```powershell
PS C:\ADCS\Auditor> Get-Domain -Domain internalcb.corp


Forest                  : internalcb.corp
DomainControllers       : {cbi-dc.internalcb.corp}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  :
PdcRoleOwner            : cbi-dc.internalcb.corp
RidRoleOwner            : cbi-dc.internalcb.corp
InfrastructureRoleOwner : cbi-dc.internalcb.corp
Name                    : internalcb.corp
```

- Find Domain Trusts
```powershell
PS C:\ADCS\Auditor> Get-DomainTrust -Domain internalcb.corp


SourceName      : internalcb.corp
TargetName      : cb.corp
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Bidirectional
WhenCreated     : 5/3/2023 7:27:00 PM
WhenChanged     : 9/23/2023 4:16:16 AM
```

- Find Domain Users
```powershell
PS C:\ADCS\Auditor> Get-DomainUser -Domain internalcb.corp | Select-Object -Property samaccountname,description

samaccountname description
-------------- -----------
Administrator  Built-in account for administering the computer/domain
Guest          Built-in account for guest access to the computer/domain
krbtgt         Key Distribution Center Service Account
internaluser
```

- Find Domain Computers
```powershell
PS C:\ADCS\Auditor> Get-DomainComputer -Domain internalcb.corp | Select-Object -Property samaccountname

samaccountname
--------------
CBI-DC$
```

- There is really no need to further dig for other AD misconfigurations. This looks like a very basic setup. Let's start digging for ADCS misconfigurations.
```powershell
PS C:\ADCS\Auditor> .\Certify.exe cas /domain:internalcb.corp

   _____          _   _  __
  / ____|        | | (_)/ _|
 | |     ___ _ __| |_ _| |_ _   _
 | |    / _ \ '__| __| |  _| | | |
 | |___|  __/ |  | |_| | | | |_| |
  \_____\___|_|   \__|_|_|  \__, |
                             __/ |
                            |___./
  v1.1.0

[*] Action: Find certificate authorities
[*] Using the search base 'CN=Configuration,DC=internalcb,DC=corp'


[*] Root CAs

    Cert SubjectName              : CN=CB-CA, DC=cb, DC=corp
    Cert Thumbprint               : 75E734EE4BB472BD99FF2E308DE9B95EEAF80C3F
    Cert Serial                   : 51F5AA83C01B57B34635410A3738E79D
    Cert Start Date               : 1/11/2023 4:46:01 AM
    Cert End Date                 : 1/11/2028 4:56:01 AM
    Cert Chain                    : CN=CB-CA,DC=cb,DC=corp

<snip>

CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates, Enroll       INTERNALCB\internaluser       S-1-5-21-2177854049-4204292666-1463338204-1104
      Allow  ManageCA, ManageCertificates               CB\Domain Admins              S-1-5-21-2928296033-1822922359-262865665-512
      Allow  ManageCA, ManageCertificates               CB\Enterprise Admins          S-1-5-21-2928296033-1822922359-262865665-519

<snip>
```

